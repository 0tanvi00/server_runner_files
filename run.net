using System;
using System.Diagnostics;
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.Hosting;

var builder = WebApplication.CreateBuilder(args);
var app = builder.Build();

app.MapGet("/", () =>
{
    CallPythonScript();
    return "C# server is running!\n";
});

app.Run("http://localhost:3000");

void CallPythonScript()
{
    var process = new Process();
    process.StartInfo.FileName = "python";
    process.StartInfo.Arguments = "test.py";
    process.StartInfo.RedirectStandardOutput = true;
    process.StartInfo.RedirectStandardError = true;
    process.Start();

    string output = process.StandardOutput.ReadToEnd();
    string error = process.StandardError.ReadToEnd();

    Console.WriteLine($"Python script output: {output}");
    if (!string.IsNullOrEmpty(error))
        Console.WriteLine($"Error from Python script: {error}");

    process.WaitForExit();
    Console.WriteLine($"Python script exited with code {process.ExitCode}");
}
